workflow:
  rules:
    - if: '$CI_MERGE_REQUEST_ID && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "main"'
      when: always
    - if: '$CI_PIPELINE_SOURCE == "web"'
      when: always

stages:
  - test
  - build
  - deploy

# Test stage
run-tests:
  stage: test
  image: openjdk:24-slim-bookworm
  script:
    - chmod +x ./runTests
    - ./runTests

# Build stage: Generate Javadoc
generate_javadoc:
  stage: build
  image: openjdk:24-slim-bookworm
  script:
    - chmod +x ./genDoc
    - ./genDoc
  artifacts:
    paths:
      - docs

# Build stage: Generate deliverable
generate_deliverable:
  stage: build
  image: openjdk:24-slim-bookworm
  script:
    - chmod +x ./genDeliverable
    - ./genDeliverable
  artifacts:
    paths:
      - $DELIVERABLE_PATH
    expire_in: 1 week

# Deploy stage: Deploy Javadoc to GitLab Pages
pages:
  stage: deploy
  script:
    - mv docs public
  artifacts:
    paths:
      - public